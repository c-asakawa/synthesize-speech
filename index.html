<html lang="en">
<head>
    <title>Speech Synthesizer</title>
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=0"/> <!--320-->

    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="mobile-web-app-capable" content="yes">

    <!-- favicon -->
    <link rel="shortcut icon" type="image/png" href="https://s3-us-west-2.amazonaws.com/asakawa.resources/sound-icon.ico"/>

    <!-- Angular Material style sheet -->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://gitcdn.github.io/bootstrap-toggle/2.2.2/css/bootstrap-toggle.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/angular-drag-and-drop-lists/2.1.0/angular-drag-and-drop-lists.min.js">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/Ladda/1.0.5/ladda-themeless.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/please-wait/0.0.5/please-wait.min.css">

    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular.min.js"></script>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/angularjs/1.5.5/angular-animate.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-local-storage/0.7.1/angular-local-storage.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>
    <script type="text/javascript" src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="https://gitcdn.github.io/bootstrap-toggle/2.2.2/js/bootstrap-toggle.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Ladda/1.0.5/spin.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/Ladda/1.0.5/ladda.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/angular-ladda/0.4.3/angular-ladda.min.js"></script>
    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/please-wait/0.0.5/please-wait.min.js"></script>

    <script>
        //Define an angular module for our app
        var app = angular.module('pollyApp', ['ngAnimate', 'LocalStorageModule', 'angular-ladda']);

        app.controller('pollyController', function($scope, $timeout, $interval, localStorageService){

            // flag to force app to load defaults
            var initDefault = window.location.href.includes('init');
            // debug flag
            var debug = window.location.href.includes('debug');

            // Mapping of the OutputFormat parameter of the SynthesizeSpeech API
            // and the audio format strings understood by the browser
            var AUDIO_FORMATS = {
                'ogg_vorbis': 'audio/ogg',
                'mp3': 'audio/mpeg',
                'pcm': 'audio/wave; codecs=1'
            };
            var maxHistoryCount = 100;
            var textTimeout = 1000;
            var savedPhrasesObject = [];
            var defaultPhrases = [
                [
                    { loading: false, text: 'Hi, how are you doing?'}, 
                    { loading: false, text: 'You are the best child, I love you.'}
                ],
                [
                    { loading: false, text: 'I can understand everything you say, however I have a condition where I cannot speak. I have to use this device to communicate.'}
                ],
                [{ loading: false, text: 'I\'m hungry'}, { loading: false, text: 'Please Help'}],
            ]

            var localStorage = {};

            $scope.selection = {
                index       : 0, // defaults to female Joanna voice
                femaleIndex : 0,
                maleIndex   : 4,
                isMale      : false,
            }

            //$scope.selection.index = 0;
            //$scope.isMale = false;
            $scope.voices = [];
            $scope.text = '';
            $scope.supportedFormats = getSupportedAudioFormats(player);
            $scope.history = [];
            $scope.saved = [];
            $scope.toastMessage = 'error';
            $scope.previousText = '';
            $scope.editMode = false;
            $scope.showVoiceMenu = false;
            $scope.isSmallViewport = $(window).width() < 768;

            // init the application
            initApp();

            $scope.clear = function() { $scope.text = ''; }
            // this method is called from selecting a voice drop down option,
            // and also when toggling the gender selection
            $scope.selectVoice = function(index) { 
                if (debug) { console.log('selectVoice() index:', index); }
                $scope.selection.index = index;
                // set the gender selection index
                if ($scope.selection.isMale) {
                    $scope.selection.maleIndex = index;
                }
                else {
                    $scope.selection.femaleIndex = index;
                }
                localStorage.selection = $scope.selection;
                localStorageService.set('polly', localStorage);
            }
            // this function is called from user clicking the save button
            $scope.save = function() { 
                // dont proceed if the text is already saved.
                if ($scope.text.length == 0) {
                    throwToast('Enter some text, then press the save button again.');
                    return;
                }

                if (checkSaveDupes()) {
                    throwToast('This phrase has already been saved.')
                    return;
                }
                if (debug) { console.log('adding to save object', $scope.saved); }
                var minLength = Math.min($scope.saved[0].length, $scope.saved[1].length, $scope.saved[2].length);
                // add it to the first column that matches the min length
                for(var i=0; i < $scope.saved.length; i++) {
                    if ($scope.saved[i].length == minLength) {
                        $scope.saved[i].push({loading:false, text:$scope.text});
                        break;
                    }
                }
                $scope.clear();
                localStorage.saved = $scope.saved;
                localStorageService.set('polly', localStorage);
            }
            // synthesizes the speech in the input text box
            $scope.synthesize = function(newText, callback) {
                newText = newText == true ? true : false;
                // pass an empty function if callback is not provided
                callback = callback == undefined ? function(){} : callback;

                var selectedVoice = $scope.voices[$scope.selection.index].Id;
                if (debug) { console.log('synthesizing text:', $scope.text) }

                $timeout(function() {
                    $scope.text = '';
                }, textTimeout);

                // error checking
                if ($scope.text.length == 0) {
                    throwToast('Enter some text, so I can turn it to speech.')
                    return callback();
                }
                else if (selectedVoice == undefined) {
                    throwToast('Select a voice for me to use.')
                    return callback();
                }
                else if ($scope.supportedFormats == undefined) {
                    throwToast('This Browser does not support this app.')
                    return callback();
                }
                else {
                    if (!newText) {
                        $scope.loading = true;
                        addToHistory();
                    }
                    // Point the player to the streaming server
                    player.src = '/read?voiceId=' +
                        encodeURIComponent(selectedVoice) +
                        '&text=' + encodeURIComponent($scope.text) +
                        '&outputFormat=' + $scope.supportedFormats[0];
                    player.play().then(function() {
                        $scope.loading = false;
                        // clear out the text input
                        return callback();
                    });
                    // Stop the form from submitting,
                    // Submitting the form is allowed only if the browser doesn't
                    // support Javascript to ensure functionality in such a case
                    event.preventDefault();
                }
            }
            // if user presses the enter key while focusing text input
            $scope.pressEnterOnText = function(event) {
                event.preventDefault();
                $scope.synthesize(false, function(){});
            }
            $scope.clickEntry = function(entry) { 
                if (debug) { console.log('clickedHistory:', entry); }
                $scope.text = entry.text;
                entry.loading = true;
                $scope.synthesize(true, function() {
                    entry.loading = false
                });
            }
            $scope.toggleDragDrop = function() {
                $("ul.savedPhrases").sortable("disable");
            }
            $scope.redoLast = function() {
                if ($scope.history.length == 0) {
                    throwToast('There is no previous message for me to say.');
                    return;
                }
                $scope.text = $scope.history[0].text;
                $scope.synthesize();
            }
            $scope.toggleEdit = function() {
                // currently enabled, toggle it
                if ($scope.editMode) {
                    $("ul.savedPhrases").sortable("disabled");
                    $scope.editMode = false;
                }
                else {
                    $("ul.savedPhrases").sortable("enable");
                    $scope.editMode = true;
                }
            }
            $scope.removeSaved = function(column, index) {
                if (debug) { console.log('removeSaved:', column, index, $scope.saved); }
                if(index > -1) {
                    $scope.saved[column].splice(index, 1);
                }
                localStorage.saved = $scope.saved;
                localStorageService.set('polly', localStorage);
            }
            $scope.focusInput = function() {
                $timeout(function (){
                    var x = window.scrollX;
                    y = window.scrollY;
                    $('#speechInput').focus();
                    window.scrollTo(x, y);
                }, 100);
            }
            $scope.toggleVoiceMenu = function() { 
                $scope.showVoiceMenu = !$scope.showVoiceMenu;
            }

            function initApp() {

                var loading_screen = pleaseWait({
                  // logo: false,
                  backgroundColor: '#fff',
                  loadingHtml: "<div class=\"spinner\"> \
                                  <div class=\"double-bounce1\"></div> \
                                  <div class=\"double-bounce2\"></div> \
                                </div>"
                });

                getVoices(function() {
                    initLocalStorage();
                    $scope.$apply();
                    initToggle();
                    initTooltips();
                    initDragDrop();
                    $scope.focusInput();
                    loading_screen.finish();
                });

                // check the view port window with size
                $interval(function() {
                    $scope.isSmallViewport = $(window).width() < 768;
                }, 500)
            }

            function initLocalStorage() {
                localStorage = localStorageService.get('polly');
                if (debug) { console.log('current state of the local storage:', angular.copy(localStorage)); }

                // new instance? if so init a new storage object
                if (initDefault || localStorage == null) {
                    localStorage = {
                        selection: $scope.selection,
                        language: 'english',
                        history: [],
                        saved: defaultPhrases,
                    }

                    $scope.history = localStorage.history;
                    $scope.saved = defaultPhrases;

                    // set the new default local storage object
                    localStorageService.set('polly', localStorage);
                }
                // use the storage object to set up the env.
                else {
                    if (debug) { console.log('init app with storage object'); }
                    // correct an older version of local storage that did not use this
                    if (localStorage.selection == undefined) {
                        localStorage.selection = $scope.selection;
                    }

                    $scope.selection = localStorage.selection;
                    if ($scope.selection.isMale) {
                        $('#genderToggle').bootstrapToggle('toggle');
                    }

                    // validate the history and saved lists
                    $scope.history =  validateData(localStorage.history) ? localStorage.history : [];
                    $scope.saved =  validateData(localStorage.saved) ? localStorage.saved : defaultPhrases;
                }
            }

            function validateData(list) {
                for (var column=0; column < list.length; column++) {
                    for (var entry=0; entry < list[column].length; entry++) {
                        if (list[column][entry].text == undefined || list[column][entry].loading == undefined) {
                            if (debug) { console.log('error: corrupt local storage data'); }
                            return false;
                        }
                    }
                }
                return true;
            }

            function initTooltips() {
                $(document).ready(function () {
                    $('button').tooltip();
                });
            }

            function initToggle() {
                /* init toggle and toggle event listener */
                $(function() {
                    // init the toggle
                    $('#genderToggle').bootstrapToggle();

                    // event to watch changes in the toggle.
                    $('#genderToggle').change(function() {
                        if (debug) { console.log('toggled:', $(this).prop('checked')); }

                        if ($(this).prop('checked')) {
                            $scope.selection.isMale = false;
                            $scope.selectVoice($scope.selection.femaleIndex);                            
                        }
                        else {
                            $scope.selection.isMale = true;
                            $scope.selectVoice($scope.selection.maleIndex);                            
                        }
                        $scope.$apply();
                    });
                });
            }
            function initDragDrop() {
                /* toggle event listener */
                $(function() {
                    savedPhrasesObject = $("ul.savedPhrases").sortable({
                      group: 'savedPhrases',
                      pullPlaceholder: false,
                      disabled: true,
                      // animation on drop
                      onDrop: function ($item, container, _super) {
                        var $clonedItem = $('<li/>').css({height: 0});
                        $item.before($clonedItem);
                        $clonedItem.animate({'height': $item.height()});

                        $item.animate($clonedItem.position(), function  () {
                          $clonedItem.detach();
                          _super($item, container);
                        });
                        // correct animation offset
                        $item.animate({
                            padding: "10px 26px"
                        }, 200);
                        updateSaveOrder();
                      },

                      // set $item relative to cursor position
                      onDragStart: function ($item, container, _super) {
                        var offset = $item.offset(),
                            pointer = container.rootGroup.pointer;

                        adjustment = {
                          left: pointer.left - offset.left,
                          top: pointer.top - offset.top
                        };

                        _super($item, container);
                      },
                      onDrag: function ($item, position) {
                        $item.css({
                          left: position.left - adjustment.left,
                          top: position.top - adjustment.top
                        });
                      }
                    });
                    if(debug) { console.log('savedPhrasesObject:', savedPhrasesObject); }
                    $("ul.savedPhrases").sortable("disable");
                });
            }

            function addToHistory() {
                for (var i=0; i < $scope.history.length; i++) {
                    if ($scope.text == $scope.history[i].text) {
                        $scope.history.splice(i, 1);
                        break;
                    }
                }
                $scope.history.unshift({loading:false, text:$scope.text});

                if ($scope.history.length > maxHistoryCount) {
                    $scope.history.splice(-1, 1);
                }
                localStorage.history = $scope.history;
                localStorageService.set('polly', localStorage);
            }

            function checkSaveDupes() {
                // loop through the columns
                for (var i=0; i < $scope.saved.length; i++) {
                    for (var j=0; j < $scope.saved[i].length; j++) {
                        if ($scope.saved[i][j].text == $scope.text) {
                            if (debug) { console.log('dupe found'); }
                            return true;
                        }
                    }
                }
                return false;
            }

            function updateSaveOrder() {
                if (debug) { console.log('updateSaveOrder:', savedPhrasesObject); }
                var savedList = [];
                // loop through all three columns
                for (var i=0; i < savedPhrasesObject.length; i++) {
                    savedList[i] = [];
                    // loop through all the entries in each column
                    for (var j=0; j < savedPhrasesObject[i].children.length; j++) {
                        var text = savedPhrasesObject[i].children[j].innerText;
                        if (text.length > 0) {
                            savedList[i].push({
                                text: text,
                                loading: false,
                            });
                        }
                    }
                }
                // save the new order to local storage
                localStorage.saved = savedList;
                if (debug) { console.log('updating localStorage', localStorage) }
                localStorageService.set('polly', localStorage);
            }

            function throwToast(message) {
                $scope.toastMessage = message;
                var x = document.getElementById("toast")
                x.className = "show";
                $timeout(function(){ 
                    x.className = x.className.replace("show", ""); 
                }, 1000 * 4);
            }

            function spinButton() {
                $scope.loading = true; // start loading
                $timeout(function() {
                $scope.loading = false; // stop loading
                }, 2000);
            }

            // makes a request to get the available voices
            function getVoices (callback){
                fetchJSON('GET', '/voices',
                    // If the request succeeds
                    function (voices) {
                        // Build the list of options for the menu
                        $scope.$apply(function() {
                            voices.forEach(function (voice) {
                                // only grab the english speaking voices
                                if(voice.LanguageCode.startsWith('en')) {
                                    $scope.voices.push(voice);
                                }
                            });
                        });
                        if (debug) { console.log('successfully fetched voices:', $scope.voices); }
                        return callback();
                    },
                    // If the request fails
                    function (status, response) {
                        // Display a message in case loading data from the server
                        // fails
                        alert(status + ' - ' + response);
                });
            }


            /**
             * Handles fetching JSON over HTTP
             */
            function fetchJSON(method, url, onSuccess, onError) {
                var request = new XMLHttpRequest();
                request.open(method, url, true);
                request.onload = function () {
                    // If loading is complete
                    if (request.readyState === 4) {
                        // if the request was successful
                        if (request.status === 200) {
                            var data;

                            // Parse the JSON in the response
                            try {
                                data = JSON.parse(request.responseText);
                            } catch (error) {
                                onError(request.status, error.toString());
                            }

                            onSuccess(data);
                        } else {
                            onError(request.status, request.responseText)
                        }
                    }
                };

                request.send();
            }

            /**
             * Returns a list of audio formats supported by the browser
             */
            function getSupportedAudioFormats(player) {
                return Object.keys(AUDIO_FORMATS)
                    .filter(function (format) {
                        var supported = player.canPlayType(AUDIO_FORMATS[format]);
                        return supported === 'probably' || supported === 'maybe';
                    });
            }

            // Initialize the application when the DOM is loaded and ready to be
            // manipulated
            document.addEventListener("DOMContentLoaded", function () {
                var player = document.getElementById('player');
                var supportedFormats = getSupportedAudioFormats(player);

                // Display a message and don't allow submitting the form if the
                // browser doesn't support any of the available audio formats
                if (supportedFormats.length === 0) {
                    submit.disabled = true;
                    alert('The web browser in use does not support any of the' +
                          ' available audio formats. Please try with a different' +
                          ' one.');
                }

            });

        });
    </script>
    <link rel="stylesheet" type="text/css" href="https://cdnjs.cloudflare.com/ajax/libs/angular-material/1.1.5/angular-material.min.css" />

    <style>
        .btn-primary { background-color: #13a3d5 !important; }
        .btn-primary:active { background-color: #0c86b1 !important; }
        .btn-success { background-color: #31c35e !important  }
        .btn-success:active { background-color: #2bad53 !important  }
        .largeButton {
            height: 80px;
            font-size: 16px;
            font-weight: bold;
            margin-bottom: 5px;
        }
        .narrowButton {
            width: 32.2%;
            display: inline-grid;
            margin-top: 0 !important;
        }
        .row {
            margin: 20px 0;
        }
        .toggle{
            width: 100px !important;
            height: 55px !important;
        }
        .toggle-group > label {
            font-size: 16px;
            padding-top: 14px;
            font-weight: bold;
        }
        .dropDownToggle {
            font-size: 16px;
            font-weight: bold;
            /*height: 55px;*/
        }
        .dropDownItem {
            width: 100%;
            display: block;
            margin-left: 2px;
            padding: 16px;
            text-decoration: none;
            color: #000;
            height: 50px;
        }
        .dropDownItem:hover {
            background-color: #eee;
            text-decoration: none;
            color: #000;
        }
        .dropDownItem:active {
            background-color: #eee;
            text-decoration: none;
            color: #000;
        }
        .displayVoiceName {
            font-size: 18px;
        }

        .textInput {
            width: 100%;
            /*height: 220px;*/
            resize: none;
            border-radius: 6px;
            border-color: #eee;
            padding: 10px;
            font-size: 18px;
            padding-right: 40px;
        }
        #historyContainer {
            height: 350px;
            padding: 0 2px 4px 2px;
        }
        .phraseButton {
            background-color: #fbfbfb;
            font-size: 16px;
            white-space: normal;
            text-align: left;
            max-height: 110px;
            overflow: auto;
            border: 1px solid #CCC;
            min-height: 38px;
            padding: 10px;
        }
        .textAreaButton {
            position: absolute;
            margin-top: 5px;
            background-color: transparent;
            opacity: 0.5;
        }
        .boxShadow {
            -webkit-box-shadow: 0px 5px 10px 0px rgba(0,0,0,0.5);
            -moz-box-shadow: 0px 5px 10px 0px rgba(0,0,0,0.5);
            box-shadow: 0px 5px 10px 0px rgba(0,0,0,0.5);
        }
        #toast {
            visibility: hidden;
            min-width: 250px;
            margin-left: -125px;
            background-color: #333;
            color: #fff;
            text-align: center;
            border-radius: 2px;
            padding: 16px;
            position: fixed;
            z-index: 1;
            left: 50%;
            top: 20px;
            font-size: 17px;
        }
        #toast.show {
            visibility: visible;
            -webkit-animation: fadein 0.8s, fadeout 0.8s 4.0s;
            animation: fadein 0.8s, fadeout 0.8s 4.0s;
        }
        @-webkit-keyframes fadein {
            from {top: 0; opacity: 0;} 
            to {top: 20px; opacity: 1;}
        }
        @keyframes fadein {
            from {top: 0; opacity: 0;}
            to {top: 20px; opacity: 1;}
        }
        @-webkit-keyframes fadeout {
            from {top: 20px; opacity: 1;} 
            to {top: 0; opacity: 0;}
        }
        @keyframes fadeout {
            from {top: 20px; opacity: 1;}
            to {top: 0; opacity: 0;}
        }
        body.dragging, body.dragging * {
            cursor: move !important;
        }

        ul { list-style-type:none; padding:0; margin:0;}
        body.dragging, body.dragging * {
          cursor: move !important;
        }
        ..btn-block+.btn-block {
            margin-top: 0 !important;
        }
        .dragged {
          position: absolute;
          top: 0;
          opacity: 0.5;
          z-index: 2000;
        }
        ul.vertical {
          margin: 0 0 9px 0;
          min-height: 10px;
        }
        li {
            display: block;
            margin: 5px 0;
            padding: 9px 12px;
            background: #eee;
            width: 100%;
            border-radius: 6px;
            cursor: pointer;
        }
        li.placeholder {
            position: relative;
            margin: 0;
            padding: 0;
            border: none;
        }
        ul.savedPhrases { padding: 0 2px; }
        ul.savedPhrases li.placeholder:before {
            position: absolute;
            content: "";
            width: 0;
            height: 0;
            margin-top: -5px;
            left: -5px;
            top: -4px;
            border: 5px solid transparent;
            border-left-color: red;
            border-right: none;
        }
        .noSelect {
            -webkit-user-select: none; /* Safari */        
            -moz-user-select: none; /* Firefox */
            -ms-user-select: none; /* IE10+/Edge */
            user-select: none; /* Standard */
        }

        .navToolBar {
            margin-bottom: 0;
            height: 27px;
            min-height: 20px;
            border-radius: 6px 6px 0px 0px;
            -moz-border-radius: 6px 6px 0px 0px;
            -webkit-border-radius: 6px 6px 0px 0px;
            border: 1px solid #000000;
        }
        .backgroundColor {
            background-color: #efeeee;
            border-color: #d4d4d4 !important;
            color: #555;
        }
        .entryContainer {
            background-color: #fff;
            padding: 10px;
            overflow: auto;
        }

        .historyHelpMessage {
            top: 30px;
            color: #aaa;
            font-size: 16px;
        }
        .roundedBottom {
            border-radius: 0px 0px 6px 6px;
            -moz-border-radius: 0px 0px 6px 6px;
            -webkit-border-radius: 0px 0px 6px 6px;
            border: 1px solid #ccc;
        }
        .lockIcon {
            position: absolute;
            right: 48px;
            top: 7px;
            font-size: 18px;
        }
        .btn-female { background-color: #ffbad2; color: #fff; }
        .btn-female:active { background-color: #f2b0c7; color: #fff; }
        .btn-male { background-color: #89cff0; color: #fff; }
        .btn-male:active { background-color: #7abcdb; color: #fff; }
        .toggle {
            max-height: 36px !important;
        }
        .toggle-group > label {
            line-height: 5px !important;
        }
        .actionButtonCol {
            padding: 0;
            /*padding-right: 10px;*/
        }
        .dragHandle {
            font-size: 16px;
            color: #ccc;
            position: absolute;
            left: -20px;
            top: 8px;
        }
        .saveButtonPosition {
            position: absolute;
            right: 0;
            top: -5px;
        }
        .menuToggleButton {
            margin-bottom: 10px;
        }
        #voiceBar {
            -webkit-transition:all linear 0.2s;
            transition:all linear 0.s;
        }
        #voiceBar {
            animation: 0.5s menuExpand;
        }   
        #voiceBar.ng-hide {
            animation: 0.3s menuCollapse;
        }
        @keyframes menuExpand {
            0% {
                opacity: 0;
                height: 0;
                margin: 0;
            }    
            50% {
                opacity: 0;
                height: auto;
                margin: 20px 0;
            }
            100% {
                opacity: 1;
                height: auto;
                margin: 20px 0;
            }
        }
        @keyframes menuCollapse {
            0% {
                opacity: 1;
                height: auto;
                margin: 20px 0;
            }    
            50% {
                opacity: 0;
                height: auto;
                margin: 20px 0;
            }
            100% {
                opacity: 0;
                height: 0;
                margin: 0;
            }
        }
        .toggle{
            max-width: 80px !important;
        }
        .toggleWrench {
            max-height: 27px;
            width: 40px;
            position: absolute;
            right: 0px;
        }
        .ladda-label {
            width: 100%
        }
        .entryCloseButton {
            position: absolute;
            right: -23px;
            top: 1px;
            border-color: #ccc;
            width: 25px;
            padding: 5px 3px;
        }
        .spinner {
          width: 70px;
          height: 70px;

          position: relative;
          margin: 100px auto;
        }

        .double-bounce1, .double-bounce2 {
          width: 100%;
          height: 100%;
          border-radius: 50%;
          background-color: #13a3d5;
          opacity: 0.6;
          position: absolute;
          top: 0;
          left: 0;
          
          -webkit-animation: sk-bounce 2.0s infinite ease-in-out;
          animation: sk-bounce 2.0s infinite ease-in-out;
        }

        .double-bounce2 {
          -webkit-animation-delay: -1.0s;
          animation-delay: -1.0s;
        }

        @-webkit-keyframes sk-bounce {
          0%, 100% { -webkit-transform: scale(0.0) }
          50% { -webkit-transform: scale(1.0) }
        }

        @keyframes sk-bounce {
          0%, 100% { 
            transform: scale(0.0);
            -webkit-transform: scale(0.0);
          } 50% { 
            transform: scale(1.0);
            -webkit-transform: scale(1.0);
          }
        }
        .pg-loading-logo-header {
            display: none;
        }

        /* only show hover on non-mobile devices */
        @media (hover: hover) {
            .btn-success:hover { background-color: #2bad53 !important;  }
            .btn-primary:hover { background-color: #0c86b1 !important; }
            .btn-female:hover { background-color: #f2b0c7; color: #fff; }
            .btn-male:hover { background-color: #7abcdb; color: #fff; }
        }

    </style>
</head>

<body ng-app="pollyApp" ng-controller="pollyController" class="container" ng-cloak>
    
    <!-- user input text area row -->
    <div class="row">

        <button class="btn btn-primary menuToggleButton" 
            ng-show="isSmallViewport"
            ng-click="toggleVoiceMenu()">
            <i class="fa fa-bars" ng-show="!showVoiceMenu" aria-hidden="true"></i>
            <i class="fa fa-arrow-up" ng-show="showVoiceMenu" aria-hidden="true"></i>
        </button>

        <div class="col-sm-8" style="padding-left:0px;" ng-style="isSmallViewport ? {'padding-right': 0} : {'padding-right': '15px'}">
            <!-- <div ng-show="isSmallViewport && !showVoiceMenu" style="padding:15px"></div> -->
            <nav id="voiceBar" class="row" ng-show="!isSmallViewport || showVoiceMenu" style="margin-top:0;">
                <!-- gender toggle -->
                <div class="col-sm-6" style="padding:0;"> 
                    <input type="checkbox" checked 
                        id="genderToggle"
                        data-toggle="toggle" 
                        data-size="mini" 
                        data-on="Female" 
                        data-off="Male" 
                        data-onstyle="female" 
                        data-offstyle="male"
                        data-height="50"
                        style="max-height: 36px;max-width: 70px;"/>

                    <!-- select voice dropdown -->
                    <div class="btn-group">
                        <button type="button" 
                            class="btn btn-primary dropDownToggle" 
                            data-toggle="dropdown" 
                            aria-haspopup="true" 
                            aria-expanded="false">
                            Select a Voice&ensp;
                            <i class="fa fa-angle-down" aria-hidden="true"></i>
                        </button>
                        <div class="dropdown-menu" style="min-width:300px;">
                            <div class="dropDownItem" 
                                ng-repeat="voice in voices"
                                ng-click="selectVoice($index)"
                                ng-show="!selection.isMale && voice.Gender == 'Female'">
                                {{voice.Name}} ({{voice.LanguageName}})
                            </div>
                            <div class="dropDownItem" 
                                ng-repeat="voice in voices"
                                ng-click="selectVoice($index)"
                                ng-show="selection.isMale && voice.Gender == 'Male'">
                                {{voice.Name}} ({{voice.LanguageName}})
                            </div>
                        </div>
                    </div>
                </div>
                <!-- display the selected voice -->
                <div class="col-sm-6" style="padding-top: 6px;">
                    <span class="displayVoiceName">
                        <i class="fa fa-male" aria-hidden="true" ng-show="voices[selection.index].Gender == 'Male'"></i>
                        <i class="fa fa-female" aria-hidden="true" ng-show="voices[selection.index].Gender == 'Female'"></i>
                        &ensp;
                        {{voices[selection.index].Name}} ({{voices[selection.index].LanguageName}})
                    </span>
                </div>
                <!-- </div> -->
            </nav> <!-- end voice selection row -->

            <!-- user input text area -->
            <button class="btn textAreaButton" 
                ng-if="history.length > 0 && text.length == 0"
                ng-click="redoLast()"
                ng-style="isSmallViewport ? {'right': '0'} : {'right': '20px'}">
                <i class="fa fa-undo" aria-hidden="true" style="font-size:20px;color: #555;"></i>
            </button>
            <button class="btn textAreaButton"
                ng-if="text.length > 0"
                ng-click="clear()"
                ng-style="isSmallViewport ? {'right': '0'} : {'right': '20px'}"
                data-toggle="tooltip" data-placement="bottom" title="Clear">
                <i class="fa fa-ban" aria-hidden="true" style="font-size:20px;color: #555;"></i>
            </button>
            <textarea ng-model="text" 
                ng-style="isSmallViewport ? {'height': '80px'} : {'height': '220px'}"
                id="speechInput"
                class="textInput boxShadow"
                ng-keydown="$event.keyCode == 13 && pressEnterOnText($event);"
                placeholder="Type Here"
                ng-blur="focusInput()">
            </textarea>


            <!-- action button row -->
            <div class="row">
                <div class="col-sm-6 actionButtonCol"
                    ng-style="isSmallViewport ? {'padding-right': '0'} : {'padding-right': '6px'}">
                    <!-- synthesize button -->
                    <button type="button" 
                        class="btn btn-success btn-lg btn-block largeButton"
                        id="synthesizeButton"
                        ng-click="synthesize();"
                        ladda="loading"
                        style="font-size: 24px;">
                            <i class="fa fa-volume-up" aria-hidden="true"></i>
                            &ensp;Speak
                    </button>
                </div>
                <div class="col-sm-6 actionButtonCol">
                    <!-- redo last -->
                    <button type="button" 
                        class="btn btn-primary btn-lg btn-block largeButton narrowButton" 
                        ng-click="redoLast(text)">
                        <i class="fa fa-undo" aria-hidden="true"></i>
                        &ensp;Redo 
                    </button>
                    <!-- clear text button -->
                    <button type="button"
                        class="btn btn-primary btn-lg btn-block largeButton narrowButton" 
                        ng-click="clear()">
                        <i class="fa fa-ban" aria-hidden="true"></i>
                        &ensp;Clear
                    </button>
                    <!-- save text button -->
                    <button type="button" 
                        class="btn btn-primary btn-lg btn-block largeButton narrowButton" 
                        ng-click="save(text)">
                        <i class="fa fa-floppy-o" aria-hidden="true"></i>
                        &ensp;Save
                    </button>
                </div>
          <!--       <div class="col-sm-3 actionButtonCol">
                    
                </div> -->
            </div> <!-- end action button row -->
        </div>
        <nav class="navbar col-sm-4 navToolBar backgroundColor"> 
            <i class="fa fa-clock-o" aria-hidden="true" style="font-size:18px;margin-top: 4px;"></i>
            <span style="font-size:17px;">&ensp; History</span> 
        </nav>
        <div class="col-sm-4 roundedBottom backgroundColor"
            id="historyContainer" 
            ng-style="isSmallViewport ? {'height': 'auto'} : {'height': '350px'}">
            <div class="entryContainer" 
                ng-style="isSmallViewport ? {'height': 'auto'} : {'height': '100%'}">
                <span ng-if="history.length == 0" class="historyHelpMessage noSelect">
                    Enter some text to turn into speech and it will show up here
                </span>

                <button type="button" 
                    class="btn btn-secondary btn-lg btn-block phraseButton" 
                    ng-repeat="entry in history"
                    ng-click="clickEntry(entry)"
                    ladda="entry.loading"
                    data-spinner-color="#000">
                    {{entry.text}}
                </button>
            </div>
            
        </div>

        <nav class="navbar col-sm-12 navToolBar backgroundColor"> 
            <i class="fa fa-floppy-o" aria-hidden="true" style="font-size:18px;margin-top: 4px;"></i>
            <span style="font-size:17px;">&ensp; Saved Phrases</span> 

            <div class="lockIcon">
                <i class="fa fa-lock" aria-hidden="true" ng-show="!editMode"></i>
                <i class="fa fa-unlock" aria-hidden="true" ng-show="editMode"></i>
            </div>
            <button class="btn btn-primary toggleWrench" ng-click="toggleEdit()">
                <i class="fa fa-wrench" aria-hidden="true" style="font-size:16px;margin-right: 5px"></i>
            </button>
        </nav>
        <div class="col-sm-12 roundedBottom backgroundColor" style="padding: 0 2px 4px 2px;">
            <div class="row entryContainer" style="margin:0;padding-top: 5px;">
                <ul class='col-sm-4 savedPhrases' 
                    id="savedPhrases" 
                    ng-repeat="column in saved"
                    ng-init="columnNumber = $index">
                    <li ng-repeat="entry in column" 
                        class="btn phraseButton noSelect" 
                        ng-click="!editMode && clickEntry(entry)"
                        ladda="entry.loading"
                        data-spinner-color="#000"
                        ng-style="editMode ? { 'padding': '10px 26px' } : { 'padding': '10px' }">
                        <i class="fa fa-bars dragHandle" aria-hidden="true" ng-show="editMode"></i>
                        {{entry.text}}

                        <button ng-show="editMode"
                            class="btn entryCloseButton" 
                            ng-click="removeSaved(columnNumber, $index)">
                            <i class="fa fa-times" aria-hidden="true"></i>
                        </button>
                    </li>
                </ul>
            </div>
        </div>

    </div>

    <div id="toast">
        <i class="fa fa-commenting-o" aria-hidden="true"></i>
        &ensp; {{toastMessage}}
    </div>

    <!-- audio element: does not display anything -->
    <audio id="player"></audio>

    <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/jquery-sortable/0.9.13/jquery-sortable-min.js"></script>


</body>

</html>